{% extends 'base/home.html' %}
{% block titulo %}{{ proyecto }}{% endblock titulo %}
{% block proyecto %}
    <h1>Proyecto: {{ proyecto }}</h1>
{% endblock proyecto %}
{% block cuerpo %}
    <h3>Informacion general</h3>
    <table>
        <tr>
            <td>Estado: </td>
            <td>{{ proyecto.estado }}</td>
        </tr>
        <tr>
            <td>Descripcion: </td>
            <td>{{ proyecto.descripcion }}</td>
        </tr>
        <tr>
            <td>Fecha de inicio: </td>
            <td>{{ proyecto.fecha_inicio }}</td>
        </tr>
        <tr>
            <td>Fecha final: </td>
            <td>{{ proyecto.fecha_fin }}</td>
        </tr>
    </table>
    <h3>Miembros</h3>
    <table>
        <tr>
            <th>Usuario</th>
            <th>Rol</th>
        </tr>
        {% for m in miembros %}
            <tr>
                <td>{{ m.usuario }}</td>
                <td>{% for r in m.rol.get_queryset %}
                    {{ r }}<br>
                {% endfor %}</td>
                {% if 'Gestionar Roles De Un Usuario' in permisos %}
                    <td class="enlace"><a href="{% url 'proyectos:gestionar_roles' proyecto.id m.id %}">Gestionar Roles</a></td>
                {% endif %}
            </tr>
        {% endfor %}
    </table><br>
    <div class="enlace">
    {% if proyecto.estado == 'Planificacion' %}
        {% if "Iniciar Proyecto" in permisos %}
        <button class="boton" onclick="location.href='{% url 'proyectos:iniciar_proyecto' proyecto.id %}'">Iniciar</button>
        {% endif %}
    {% elif proyecto.estado == 'En ejecucion' %}
        {% if "Finalizar Proyecto" in permisos %}
        <button class="boton" onclick="location.href='{% url 'proyectos:finalizar_proyecto' proyecto.id %}'">Finalizar</button>
        {% endif %}
        {% if "Cancelar Proyecto" in permisos %}
        <button class="boton" onclick="location.href='{% url 'proyectos:cancelar_proyecto' proyecto.id %}'">Cancelar</button>
        {% endif %}
    {% endif %}
    {% if proyecto.estado == 'Planificacion' or proyecto.estado == 'En ejecucion' %}
        {% if 'Visualizar Roles' in permisos %}
            <a href="{% url 'roles:index' proyecto.id %}">Roles</a>
        {% endif %}
        {% if "Asignar Miembros" in permisos %}
        <a href="{% url 'proyectos:asignar_usuarios' proyecto.id %}">Asignar Miembros</a>
        {% endif %}
        {% if "Desasignar Miembros" in permisos %}
        <a href="{% url 'proyectos:desasignar_usuarios' proyecto.id %}">Desasignar Miembros</a>
        {% endif %}
        {% if "Visualizar US" in permisos %}
        <a href="{%  url 'userstory:listar_us' proyecto.id %}">Product Backlog</a>
        {% endif %}
        <a href="{%  url 'sprints:index' proyecto.id %}">Sprints</a>
    {% endif %}
    <a href="{% url 'proyectos:listar_proyectos' %}">Volver</a>
    </div>
{% endblock cuerpo %}